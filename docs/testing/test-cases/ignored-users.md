# Тест-кейсы: Управление игнорируемыми пользователями

## Добавление пользователей в список игнорируемых

### TC-IGNORE-001: Добавление пользователя в список игнорируемых

- **Связанные User Stories**: US-10
- **Приоритет**: P1
- **Предусловия**:
    - Пользователь авторизован с ролью администратора
    - В системе есть обычный пользователь "player1@example.com"

- **Шаги**:
    1. Перейти в раздел "Управление игнорируемыми пользователями"
    2. Нажать кнопку "Добавить пользователя"
    3. В поле поиска ввести "player1@example.com"
    4. Выбрать пользователя из списка результатов
    5. Ввести причину игнорирования: "Тестирование системы"
    6. Нажать кнопку "Добавить в список игнорируемых"

- **Ожидаемый результат**:
    - Пользователь успешно добавлен в список игнорируемых
    - В таблице игнорируемых пользователей появляется новая запись
    - Запись содержит: имя пользователя, email, дату добавления, причину
    - Отображается уведомление об успешном добавлении

- **Среда тестирования**: Все поддерживаемые браузеры
- **Автоматизация**: Да, E2E и Integration тесты

### TC-IGNORE-002: Добавление нескольких пользователей в список игнорируемых

- **Связанные User Stories**: US-10
- **Приоритет**: P2
- **Предусловия**:
    - Пользователь авторизован с ролью администратора
    - В системе есть обычные пользователи "player1@example.com", "player2@example.com" и "player3@example.com"

- **Шаги**:
    1. Перейти в раздел "Управление игнорируемыми пользователями"
    2. Нажать кнопку "Массовое добавление"
    3. В поле "Список пользователей" ввести:
       ```
       player1@example.com
       player2@example.com
       player3@example.com
       ```
    4. Ввести общую причину игнорирования: "Тестирование системы"
    5. Нажать кнопку "Добавить всех в список игнорируемых"

- **Ожидаемый результат**:
    - Все указанные пользователи успешно добавлены в список игнорируемых
    - В таблице игнорируемых пользователей появляются новые записи
    - Каждая запись содержит указанную причину игнорирования
    - Отображается уведомление об успешном добавлении с указанием количества добавленных пользователей

- **Среда тестирования**: Все поддерживаемые браузеры
- **Автоматизация**: Да, E2E тест

### TC-IGNORE-003: Попытка добавления несуществующего пользователя

- **Связанные User Stories**: US-10
- **Приоритет**: P2
- **Предусловия**:
    - Пользователь авторизован с ролью администратора
    - Пользователь "nonexistent@example.com" не существует в системе

- **Шаги**:
    1. Перейти в раздел "Управление игнорируемыми пользователями"
    2. Нажать кнопку "Добавить пользователя"
    3. В поле поиска ввести "nonexistent@example.com"
    4. Нажать кнопку "Поиск"

- **Ожидаемый результат**:
    - Система сообщает, что пользователь не найден
    - Отображается сообщение: "Пользователь с email nonexistent@example.com не найден"
    - Кнопка "Добавить в список игнорируемых" недоступна

- **Среда тестирования**: Все поддерживаемые браузеры
- **Автоматизация**: Да, E2E и Unit тесты

### TC-IGNORE-004: Попытка добавления уже игнорируемого пользователя

- **Связанные User Stories**: US-10
- **Приоритет**: P2
- **Предусловия**:
    - Пользователь авторизован с ролью администратора
    - Пользователь "already-ignored@example.com" уже находится в списке игнорируемых

- **Шаги**:
    1. Перейти в раздел "Управление игнорируемыми пользователями"
    2. Нажать кнопку "Добавить пользователя"
    3. В поле поиска ввести "already-ignored@example.com"
    4. Выбрать пользователя из списка результатов
    5. Ввести причину игнорирования: "Повторное добавление"
    6. Нажать кнопку "Добавить в список игнорируемых"

- **Ожидаемый результат**:
    - Отображается предупреждение: "Пользователь уже находится в списке игнорируемых"
    - Предлагается обновить причину игнорирования для существующей записи
    - При подтверждении обновляется только причина игнорирования, без создания дубликата

- **Среда тестирования**: Все поддерживаемые браузеры
- **Автоматизация**: Да, E2E и Integration тесты

## Удаление пользователей из списка игнорируемых

### TC-IGNORE-005: Удаление пользователя из списка игнорируемых

- **Связанные User Stories**: US-10
- **Приоритет**: P1
- **Предусловия**:
    - Пользователь авторизован с ролью администратора
    - В списке игнорируемых есть пользователь "ignored-user@example.com"

- **Шаги**:
    1. Перейти в раздел "Управление игнорируемыми пользователями"
    2. Найти в таблице пользователя "ignored-user@example.com"
    3. Нажать кнопку "Удалить из списка" для этого пользователя
    4. В диалоговом окне подтверждения нажать "Подтвердить"

- **Ожидаемый результат**:
    - Пользователь успешно удален из списка игнорируемых
    - Запись о пользователе исчезает из таблицы игнорируемых пользователей
    - Отображается уведомление об успешном удалении
    - Пользователь может снова получать очки за тапы в активных раундах

- **Среда тестирования**: Все поддерживаемые браузеры
- **Автоматизация**: Да, E2E и Integration тесты

### TC-IGNORE-006: Массовое удаление пользователей из списка игнорируемых

- **Связанные User Stories**: US-10
- **Приоритет**: P2
- **Предусловия**:
    - Пользователь авторизован с ролью администратора
    - В списке игнорируемых есть несколько пользователей

- **Шаги**:
    1. Перейти в раздел "Управление игнорируемыми пользователями"
    2. Отметить чекбоксы напротив нескольких пользователей
    3. Нажать кнопку "Удалить выбранных"
    4. В диалоговом окне подтверждения нажать "Подтвердить"

- **Ожидаемый результат**:
    - Все выбранные пользователи успешно удалены из списка игнорируемых
    - Записи о выбранных пользователях исчезают из таблицы
    - Отображается уведомление об успешном удалении с указанием количества удаленных записей
    - Все удаленные из списка пользователи могут снова получать очки за тапы

- **Среда тестирования**: Все поддерживаемые браузеры
- **Автоматизация**: Да, E2E тест

## Влияние списка игнорируемых на подсчет очков

### TC-IGNORE-007: Проверка влияния игнорирования на подсчет очков

- **Связанные User Stories**: US-09, US-10
- **Приоритет**: P0
- **Предусловия**:
    - Пользователь "ignored-player@example.com" авторизован с ролью игрока
    - Пользователь находится в списке игнорируемых
    - В системе есть активный раунд

- **Шаги**:
    1. Перейти на страницу активного раунда
    2. Нажать кнопку "Тап" несколько раз
    3. Проверить личный счет пользователя
    4. Проверить общую таблицу лидеров

- **Ожидаемый результат**:
    - Тапы регистрируются в системе (отображается уведомление о регистрации тапа)
    - Счетчик тапов пользователя увеличивается
    - Очки за тапы не начисляются (счетчик очков остается на 0)
    - В таблице лидеров пользователь отображается с пометкой "Игнорируется" и 0 очков
    - В истории тапов все тапы имеют пометку "Игнорируемый тап"

- **Среда тестирования**: Все поддерживаемые браузеры
- **Автоматизация**: Да, E2E и Integration тесты

### TC-IGNORE-008: Проверка возобновления начисления очков после удаления из списка игнорируемых

- **Связанные User Stories**: US-09, US-10
- **Приоритет**: P1
- **Предусловия**:
    - Администратор авторизован в системе
    - Пользователь "to-unignore@example.com" находится в списке игнорируемых
    - Пользователь "to-unignore@example.com" авторизован в отдельной сессии
    - В системе есть активный раунд

- **Шаги**:
    1. В сессии пользователя "to-unignore@example.com":
        - Перейти на страницу активного раунда
        - Нажать кнопку "Тап"
        - Убедиться, что очки не начисляются
    2. В сессии администратора:
        - Перейти в раздел "Управление игнорируемыми пользователями"
        - Удалить пользователя "to-unignore@example.com" из списка игнорируемых
    3. В сессии пользователя "to-unignore@example.com":
        - Нажать кнопку "Тап" еще раз
        - Проверить начисление очков

- **Ожидаемый результат**:
    - До удаления из списка игнорируемых очки за тапы не начисляются
    - После удаления из списка очки начинают начисляться за новые тапы
    - В таблице лидеров пользователь отображается без пометки "Игнорируется"
    - Отображается уведомление о том, что пользователь больше не игнорируется

- **Среда тестирования**: Все поддерживаемые браузеры
- **Автоматизация**: Да, E2E тест с несколькими сессиями

### TC-IGNORE-009: Просмотр истории изменений списка игнорируемых

- **Связанные User Stories**: US-10
- **Приоритет**: P3
- **Предусловия**:
    - Пользователь авторизован с ролью администратора
    - В системе есть история изменений списка игнорируемых

- **Шаги**:
    1. Перейти в раздел "Управление игнорируемыми пользователями"
    2. Нажать кнопку "История изменений"

- **Ожидаемый результат**:
    - Отображается таблица с историей изменений списка игнорируемых
    - Для каждого изменения показано: дата/время, тип действия (добавление/удаление), пользователь, причина, администратор
    - Таблицу можно фильтровать по типу действия, пользователю, администратору
    - Таблицу можно сортировать по дате/времени

- **Среда тестирования**: Все поддерживаемые браузеры
- **Автоматизация**: Да, E2E тест

### TC-IGNORE-010: Экспорт списка игнорируемых пользователей

- **Связанные User Stories**: US-10
- **Приоритет**: P3
- **Предусловия**:
    - Пользователь авторизован с ролью администратора
    - В списке игнорируемых есть несколько пользователей

- **Шаги**:
    1. Перейти в раздел "Управление игнорируемыми пользователями"
    2. Нажать кнопку "Экспорт списка"
    3. В диалоговом окне выбрать формат экспорта: CSV
    4. Нажать "Скачать"

- **Ожидаемый результат**:
    - Начинается скачивание файла со списком игнорируемых пользователей
    - Файл содержит корректные данные: имя пользователя, email, дата добавления, причина
    - Формат файла соответствует выбранному (CSV)

- **Среда тестирования**: Все поддерживаемые браузеры
- **Автоматизация**: Да, Integration тест