### 2. Компонентная диаграмма API

# Компонентная диаграмма: API

## Обзор

Данный документ описывает компонентную диаграмму API системы подсчета очков, включая структуру API, взаимодействие между компонентами и интеграцию с внешними системами.

## Компоненты API

### API Gateway

API Gateway служит единой точкой входа для всех клиентских запросов и выполняет следующие функции:
- Маршрутизация запросов к соответствующим микросервисам
- Аутентификация и авторизация
- Ограничение скорости запросов (Rate limiting)
- Кэширование ответов
- Трансформация запросов и ответов

### REST API endpoints

- **/api/v1/auth** - Эндпоинты аутентификации и управления пользователями
- **/api/v1/rounds** - Управление игровыми раундами
- **/api/v1/taps** - Регистрация тапов и управление очками
- **/api/v1/stats** - Доступ к статистике и истории игр
- **/api/v1/admin** - Административные функции

### WebSocket API

- **/ws/rounds** - Обновления статуса раундов в реальном времени
- **/ws/scores** - Обновления счета в реальном времени
- **/ws/notifications** - Системные уведомления

## Диаграмма компонентов API
```mermaid
 graph TD 
 Client[Клиент] --> Gateway[API Gateway] Gateway --> Auth[Auth API] Gateway --> Rounds[Rounds API] Gateway --> Taps[Taps API] Gateway --> Stats[Stats API] Gateway --> Admin[Admin API] Gateway --> WSHandler[WebSocket Handler]
Auth --> UserService[Сервис пользователей]
Rounds --> RoundService[Сервис раундов]
Taps --> ScoreService[Сервис подсчета очков]
Stats --> AnalyticsService[Сервис аналитики]
Admin --> AdminService[Административный сервис]

WSHandler --> NotificationService[Сервис уведомлений]

UserService --> DB[(База данных)]
RoundService --> DB
ScoreService --> DB
AnalyticsService --> DB
AdminService --> DB
NotificationService --> WSBroker[WebSocket Брокер]
``` 

## Архитектурные принципы API

### RESTful дизайн
- Ресурсно-ориентированная архитектура
- Использование HTTP методов (GET, POST, PUT, DELETE)
- Стандартизированные коды ответов HTTP

### Версионирование API
- Версионирование через URL-путь (/api/v1/)
- Поддержка обратной совместимости
- Стратегия устаревания API endpoints

### Документация API
- Использование OpenAPI/Swagger для документирования API
- Интерактивная документация с возможностью тестирования
- Примеры запросов и ответов

## Интеграция с внешними системами

### Аутентификация
- Интеграция с OAuth 2.0 провайдерами
- Поддержка SAML для корпоративной аутентификации

### Webhooks
- Отправка событий на настраиваемые URL
- Настройка фильтрации событий
- Повторные попытки при сбоях

### API-клиенты
- SDK для популярных языков программирования
- Мобильные SDK для iOS и Android

## Безопасность API

- OAuth 2.0 и JWT для аутентификации
- Ограничение скорости запросов (Rate limiting)
- Валидация входных данных
- Защита от основных атак (OWASP Top 10)
```
